
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>nuts!</title>
  <meta name="author" content="chamila de alwis">

   
  <meta name="description" content="">
  
  <meta name="keywords" content="">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://chamilad.github.io">
  <link href="/favicon.png" rel="icon">
  <link href='http://fonts.googleapis.com/css?family=Quicksand:300,400' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="nuts!" type="application/atom+xml">
  <script src="/js/jquery.js"></script>
  <script src="/js/bootstrap-collapse.js"></script>
  <script src="/js/modernizr-2.0.js"></script>
  <script src="/js/octopress.js" type="text/javascript"></script>
  <script src="/js/application.js"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Libre+Baskerville:400,400italic,700' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Cabin:700' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Indie+Flower' rel='stylesheet' type='text/css'>
  

</head>

<body   >
  <div class="navbar navbar-inverse navbar-static-top">
  	<div class="navbar-inner">
  	  <div class="container">
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".navbar-responsive-collapse">
          <span class="fui-menu-24"></span>
        </a>
  	  	<div class="nav-collapse collapse navbar-responsive-collapse" style="height:0;">
  	      <ul class="nav">
    
        <li class="active"><a href="/index.html">Home</a></li>
    
</ul>

<ul class="nav pull-right">
    
    
    
    <li><a href="http://linkedin.com/in/chamiladealwis" title="Linkedin Profile"><i class="icon-linkedin-sign social-navbar"></i></a></li>
    
    
    <li><a href="http://twitter.com/chamilad" title="Twitter Profile"><i class="icon-twitter-sign social-navbar"></i></a></li>
    
    
    <li><a href="http://plus.google.com/102488741988320223009" title="Google+ Profile"><i class="icon-google-plus-sign social-navbar"></i></a></li>
    
    
    

    
</ul>

  	    </div>
  	  </div>
  	</div>
  </div>
  <div class="container" id="main">
      <div class="row-fluid">
        <div id="content">
          <div class="jumbotron">
  <div class="container">
    
      nuts!
    
    <h3 class="tagline">
      
        For the night is dark and I&#8217;d probably forget this by tomorrow
      
    </h3>
  </div>
</div>


<div class="blog-index">
  
  
  
    <article>
      

  <div class="row-fluid">
    <div class="span2 post-meta">
	  <h5 class="date-time">








  


<i class="icon-calendar-empty"></i> <time datetime="2014-07-09T22:25:05+05:30" pubdate data-updated="true">Jul 9<sup>th</sup>, 2014</time></h5>
          <div class="row-fluid">
          
          </div>
          
          <div class="row-fluid">
          
          <a href="/blog/categories/ubuntu/"><span class="badge">ubuntu</span></a>
          
          <a href="/blog/categories/wireshark/"><span class="badge">wireshark</span></a>
          
          </div>
          
    </div>
    <div class="span10 post-container">
      <h1 class="link"><a href="/blog/2014/07/09/wireshark-crashing-in-ubuntu/">Wireshark Crashing in Ubuntu</a></h1>
      <p>If you have customized your ubuntu GTK theme, Wireshark would most likely crash as soon as scrollbars come in to play. I experienced this in Ubuntu 14.04 and found the solution to be disabling overlay scrollbars that come as the default.</p>

<p>To do this simply add an environment variable called LIBOVERLAY_SCROLLBAR with value 0.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">LIBOVERLAY_SCROLLBAR</span><span class="o">=</span>0
</span></code></pre></td></tr></table></div></figure>


      
      
    </div>
  </div>



    </article>
    
    <hr>
    
  
  
    <article>
      

  <div class="row-fluid">
    <div class="span2 post-meta">
	  <h5 class="date-time">








  


<i class="icon-calendar-empty"></i> <time datetime="2014-07-07T12:26:35+05:30" pubdate data-updated="true">Jul 7<sup>th</sup>, 2014</time></h5>
          <div class="row-fluid">
          
          </div>
          
          <div class="row-fluid">
          
          <a href="/blog/categories/esb/"><span class="badge">esb</span></a>
          
          <a href="/blog/categories/wso2/"><span class="badge">wso2</span></a>
          
          </div>
          
    </div>
    <div class="span10 post-container">
      <h1 class="link"><a href="/blog/2014/07/07/wso2-esb-sample-screw-ups/">WSO2 ESB Sample Screw Ups</a></h1>
      <p>We all know the feeling when we follow every instruction of a sample page to the letter and the results turn out to be a total <del>clusterf..</del> disaster.</p>

<p>Well, let me try to easy some of the pain by listing the following probable fixes and workarounds for the 100-odd samples of the renowned <a href="http://wso2.com/products/enterprise-service-bus/">WSO2 Enterprise Service Bus</a>.</p>

<blockquote><p>Keep in mind that this post will keep getting updated till I go through every sample.</p></blockquote>

<h1>Sample 50</h1>

<p>The synapse configuration file that is shipped with 4.8.1 has an error where asterisks are missing from a filter mediater regex. Therefore execution of the main sequence stops after failing to match any <code>To</code> SOAP headers.</p>

<h2>Fix</h2>

<p>Change the following line in <code>&lt;ESB_HOME&gt;/repository/samples/synapse_sample_50.xml</code> to include the asterisks.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;filter</span> <span class="na">source=</span><span class="s">&quot;get-property(&#39;To&#39;)&quot;</span> <span class="na">regex=</span><span class="s">&quot;./StockQuote.&quot;</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The modified line should be as follows.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;filter</span> <span class="na">source=</span><span class="s">&quot;get-property(&#39;To&#39;)&quot;</span> <span class="na">regex=</span><span class="s">&quot;.*/StockQuote.*&quot;</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Sample 57</h1>

<p>In ESB 4.8.1 running this sample would not result in the expected outcome and would throw an error similar to the following.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>org.apache.synapse.SynapseException: A LoadBalanceEventHandler has not been
</span><span class='line'>specified in the axis2.xml file for the domain apache.axis2.application.domain
</span><span class='line'>at
</span><span class='line'>org.apache.synapse.core.axis2.Axis2LoadBalanceMembershipHandler.setConfigurationContext(Axis2LoadBalanceMembershipHandler.java:77)
</span></code></pre></td></tr></table></div></figure>


<p>The reason for this is the incompatibility between the clustering mechanisms used in ESB 4.8.1 (HazelCast) and the sample Axis2 server (Apache Tribes) it ships with.</p>

<h2>Fix</h2>

<p>As <a href="http://wso2-oxygen-tank.10903.n7.nabble.com/Dev-Running-ESB-sample-57-td89484.html">this</a> email thread mentions this can be overcome by getting ESB 4.7.0 where the same clustering implementation is used that of the Axis2 server.</p>

<h1>Sample 60, 61, 62</h1>

<p>In ESB 4.8.1 the synapse configuration files for the samples 60, 61, and 62 are missing and the configurations that are on the sample pages are errorneous.
For an example in sample #61 the mentioned configuration refers to a property named <code>EP_LIST</code> while there&rsquo;s no external registry resource or inline defined property that is of the name EP_LIST.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;send&gt;</span>
</span><span class='line'>    <span class="nt">&lt;endpoint&gt;</span>
</span><span class='line'>        <span class="nt">&lt;recipientlist&gt;</span>
</span><span class='line'>            <span class="nt">&lt;endpoints</span> <span class="na">value=</span><span class="s">&quot;{get-property(&#39;EP_LIST&#39;)}&quot;</span> <span class="na">max-cache=</span><span class="s">&quot;20&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/recipientlist&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/endpoint&gt;</span>
</span><span class='line'><span class="nt">&lt;/send&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Fix</h2>

<p>However these synapse configuration files are present in the 4.7.0 release and they can be used to start the 4.8.1 ESB with the desired configuration.</p>

<h1>Sample 152</h1>

<p>You would probably get an error while trying to execute the client like the following.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>[2014-07-07 13:28:09,060] ERROR - ServerWorker Error processing POST request
</span><span class='line'>java.lang.NullPointerException: Tenant domain has not been set in CarbonContext
</span><span class='line'>    at org.wso2.carbon.caching.impl.CacheManagerFactoryImpl.getCacheManager(CacheManagerFactoryImpl.java:79)
</span><span class='line'>    at org.wso2.carbon.security.pox.POXSecurityHandler.getPOXCache(POXSecurityHandler.java:383)
</span><span class='line'>    at org.wso2.carbon.security.pox.POXSecurityHandler.invoke(POXSecurityHandler.java:179)
</span><span class='line'>    at org.apache.axis2.engine.Phase.invokeHandler(Phase.java:340)
</span><span class='line'>    at org.apache.axis2.engine.Phase.invoke(Phase.java:313)
</span><span class='line'>    at org.apache.axis2.engine.AxisEngine.invoke(AxisEngine.java:261)
</span><span class='line'>    at org.apache.axis2.engine.AxisEngine.receive(AxisEngine.java:167)
</span><span class='line'>    at org.apache.axis2.transport.http.HTTPTransportUtils.processHTTPPostRequest(HTTPTransportUtils.java:172)
</span><span class='line'>    at org.apache.synapse.transport.nhttp.ServerWorker.processEntityEnclosingMethod(ServerWorker.java:459)
</span><span class='line'>    at org.apache.synapse.transport.nhttp.ServerWorker.run(ServerWorker.java:279)
</span><span class='line'>    at org.apache.axis2.transport.base.threads.NativeWorkerPool$1.run(NativeWorkerPool.java:172)
</span><span class='line'>    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
</span><span class='line'>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
</span><span class='line'>    at java.lang.Thread.run(Thread.java:722)
</span></code></pre></td></tr></table></div></figure>


<p>While I can&rsquo;t exactly pinpoint the cause of the error this happens due to the way we execute the samples. If you directly executed the sample #152 chances are that you wouldn&rsquo;t come across this. But if you started with a sample before #101 you&rsquo;d probably get this.</p>

<p>At sample #101 you have to enable the NHTTP configuration for Carbon. Non-Blocking HTTP is required to enable WS-ReliableMessaging so that the source can call the Web Service destination asynchronously.</p>

<p>You are instructed to enable NHTTP configuration by editing the <code>carbon.xml</code> file in <code>&lt;ESB_HOME&gt;/repository/conf/</code>.</p>

<figure class='code'><figcaption><span>carbon.xml start:253</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="c">&lt;!-- You are instructed to comment this line and enable the next one to enable NHTTP --&gt;</span>
</span><span class='line'><span class="nt">&lt;ConfigurationFile&gt;</span>${carbon.home}/repository/conf/axis2/axis2.xml<span class="nt">&lt;/ConfigurationFile&gt;</span>
</span><span class='line'><span class="nt">&lt;ConfigurationFile&gt;</span>${carbon.home}/repository/conf/axis2/axis2_nhttp.xml<span class="nt">&lt;/ConfigurationFile&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Fix</h2>

<p>To make the sample #152 run properly revert this change.</p>

      
      
    </div>
  </div>



    </article>
    
    <hr>
    
  
  
    <article>
      

  <div class="row-fluid">
    <div class="span2 post-meta">
	  <h5 class="date-time">








  


<i class="icon-calendar-empty"></i> <time datetime="2014-07-01T16:38:50+05:30" pubdate data-updated="true">Jul 1<sup>st</sup>, 2014</time></h5>
          <div class="row-fluid">
          
          </div>
          
          <div class="row-fluid">
          
          <a href="/blog/categories/axis2/"><span class="badge">axis2</span></a>
          
          <a href="/blog/categories/web-services/"><span class="badge">web services</span></a>
          
          <a href="/blog/categories/wso2/"><span class="badge">wso2</span></a>
          
          </div>
          
    </div>
    <div class="span10 post-container">
      <h1 class="link"><a href="/blog/2014/07/01/creating-a-web-service-using-apache-axis2-no-ide/">Creating a Web Service using Apache Axis2 [No IDE]</a></h1>
      <h1>Outline</h1>

<ol>
<li>Pre-requisites</li>
<li>Deploying Axis2</li>
<li>Writing the service class</li>
<li>Deploying the service</li>
<li>Verification</li>
</ol>


<h1>Pre-requisites</h1>

<p>We need Apache Axis2 running and a suitable container. You could also run Axis2 as a standalone server but for this let&rsquo;s use Tomcat as a container. So in the following order</p>

<ol>
<li>Download and install JDK7</li>
<li>Download and install Tomcat 7 (even 8 would do, but it seems as of now Tomcat 8 isn&rsquo;t being supported by Eclipse, so let&rsquo;s go with v7)</li>
<li>Download and install AXis2 on Tomcat</li>
</ol>


<h2>JDK7</h2>

<p>Download and extract the JDK tarball.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget --no-check-certificate --no-cookies --header <span class="s2">&quot;Cookie: oraclelicense=accept-securebackup-cookie&quot;</span> http://download.oracle.com/otn-pub/java/jdk/7u60-b19/jdk-7u60-linux-x64.tar.gz
</span><span class='line'>tar zxvf jdk-7u60-linux-x64.tar.gz
</span></code></pre></td></tr></table></div></figure>


<p>Add and modify the following lines in ~/.profile or /etc/profile (for system wide application) to add <code>JAVA_HOME</code> environment variable and it&rsquo;s bin folder to <code>$PATH</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span>/path/to/jdk/extraction
</span><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$HOME</span>/bin:<span class="nv">$JAVA_HOME</span>/bin
</span></code></pre></td></tr></table></div></figure>


<p>Refresh the terminal session and check if Java is working</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">source</span> ~/.profile
</span><span class='line'>java -version
</span></code></pre></td></tr></table></div></figure>


<h2>Tomcat 7</h2>

<p>You could install tomcat through <code>apt-get</code> or manually.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install tomcat7
</span></code></pre></td></tr></table></div></figure>


<p>Or download and set paths manually.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget http://supergsego.com/apache/tomcat/tomcat-7/v7.0.54/bin/apache-tomcat-7.0.54.tar.gz
</span><span class='line'>tar zxvf apache-tomcat-7.0.54.tar.gz
</span><span class='line'>mv apache-tomcat-7.0.54 ~/dev/
</span></code></pre></td></tr></table></div></figure>


<p>Add the <code>$CATALINA_HOME</code> env var to the bash profile.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>vi ~/.profile
</span></code></pre></td></tr></table></div></figure>


<p>Prepend the following line before exporting the $PATH.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">CATALINA_HOME</span><span class="o">=</span><span class="nv">$HOME</span>/dev/apache-tomcat-7.0.54
</span></code></pre></td></tr></table></div></figure>


<p>Server start/stop can be done by the scripts in the <code>$CATALINA_HOME/bin</code> folder.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> <span class="nv">$CATALINA_HOME</span>
</span><span class='line'>./bin/startup.sh
</span></code></pre></td></tr></table></div></figure>


<h1>Deploying Axis2</h1>

<p>Download Axis2 WAR distribution and copy the web archive file to the tomcat webapps root.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget http://apache.tradebit.com/pub//axis/axis2/java/core/1.6.2/axis2-1.6.2-war.zip
</span><span class='line'>unzip axis2-1.6.2-war.zip -d axis2-war
</span><span class='line'>cp axis2-war/axis2.war <span class="nv">$CATALINA_HOME</span>/webapps/
</span><span class='line'><span class="nb">cd</span> <span class="nv">$CATALINA_HOME</span>/bin
</span><span class='line'>./shutdown.sh
</span><span class='line'>./startup.sh
</span></code></pre></td></tr></table></div></figure>


<p>In the browser go to <a href="http://localhost:8080/axis2">http://localhost:8080/axis2</a>. Axis2 welcome page should appear.</p>

<h1>The Service</h1>

<p>An Axis2 archive (of <code>.aar</code> extension) has a certain directory structure not so different from a Web Archive.</p>

<figure class='code'><figcaption><span>Axis2 Archive Directory Structure start:1 linenos:false mark:4,9</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>.
</span><span class='line'>├── SimpleService
</span><span class='line'>    └─── META-INF
</span><span class='line'>      └─── services.xml
</span><span class='line'>    └── com
</span><span class='line'>      └─── chamiladealwis
</span><span class='line'>        └─── ws
</span><span class='line'>          └─── service
</span><span class='line'>            └─── SimpleService.java
</span></code></pre></td></tr></table></div></figure>


<p>META-INF folder contains the services descriptor file. The other is the binary which implements the service.</p>

<p>The service class itself is a plain old Java class which exposes the services it offers through public methods. My simple service would be the following.</p>

<figure class='code'><figcaption><span>SimpleService.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">chamiladealwis</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleService</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">add</span><span class="o">(</span><span class="kt">int</span> <span class="n">num1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num2</span><span class="o">)</span>
</span><span class='line'>  <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">num1</span><span class="o">+</span><span class="n">num2</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>SimpleService</code> offers just one service  named <code>add</code> which accepts two Integer parameters and returns the sum of them as an Integer.</p>

<p>Now this service needs a service descriptor which exposes the service class to Axis2 when asked.</p>

<figure class='code'><figcaption><span>services.xml mark:3</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;service&gt;</span>
</span><span class='line'>    <span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;ServiceClass&quot;</span> <span class="na">locked=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        com.chamiladealwis.ws.service.SimpleService
</span><span class='line'>    <span class="nt">&lt;/parameter&gt;</span>
</span><span class='line'>    <span class="nt">&lt;operation</span> <span class="na">name=</span><span class="s">&quot;sayHello&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;messageReceiver</span> <span class="na">class=</span><span class="s">&quot;org.apache.axis2.rpc.receivers.RPCMessageReceiver&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/operation&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/service&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>A parameter named <code>ServiceClass</code> is defined with value <code>com.chamiladealwis.ws.service.SimpleService</code> which the FQN of the Java class we just wrote.</p>

<p>Now compile sources, create the Axis2 archive and deploy it in the Axis Server.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># go to the root dir and compile the sources</span>
</span><span class='line'>javac com/chamiladealwis/ws/service/*.java
</span><span class='line'>
</span><span class='line'><span class="c"># create the archive file</span>
</span><span class='line'>jar cvf SimpleService.aar *
</span><span class='line'>
</span><span class='line'><span class="c"># copy the archive over to the Axis2 web root</span>
</span><span class='line'>cp SimpleService.aar <span class="nv">$CATALINE_HOME</span>/webapps/axis2/WEB-INF/services/
</span><span class='line'>
</span><span class='line'><span class="c"># restart tomcat</span>
</span><span class='line'><span class="nb">cd</span> <span class="nv">$CATALINA_HOME</span>/bin
</span><span class='line'>./shutdown.sh
</span><span class='line'>./startup.sh
</span></code></pre></td></tr></table></div></figure>


<p>Browse to <a href="http://localhost:8080/axis2/services/listServices">http://localhost:8080/axis2/services/listServices</a> in your browser and you will see <code>SimpleService</code> being listed as an availble service with <code>add</code> as an operation.</p>

<p>Click on the link to <code>SimpleService</code> to view the WSDL file which will describe the service and it&rsquo;s operation in an abstracted XML interpretation that can be used to create clients in any language to consume the service.</p>

<h1>The Client</h1>

<p>The client code has to make use of a &ldquo;Stub&rdquo; of the service which will act as a proxy and a communication agent. Axis2 binary distribution includes tools which can generate the Java stub using the WSDL file as the source.</p>

<p>Download the Axis2 binary distribution, extract it and set <code>AXIS2_HOME</code> environment variable to its root. Add <code>$AXIS2_HOME</code> to <code>$PATH</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget http://apache.spinellicreations.com//axis/axis2/java/core/1.6.2/axis2-1.6.2-bin.zip
</span><span class='line'>unzip axis2-1.6.2-bin.zip
</span><span class='line'><span class="nb">pwd</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add the <code>$AXIS2_HOME</code> variable before <code>export PATH</code> line and modify <code>$PATH</code> to include <code>$AXIS2_HOME/bin</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">AXIS2_HOME</span><span class="o">=</span>/path/to/axis2/binary/folder
</span><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;$PATH:$AXIS2_HOME/bin&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now refresh terminal by sourcing the .profile file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">source</span> ~/.profile
</span><span class='line'><span class="nb">echo</span> <span class="nv">$AXIS2_HOME</span>
</span></code></pre></td></tr></table></div></figure>


<p>Copy the WSDL path of the <code>SimpleService</code>, go to the directory you&rsquo;re going to create your client code and execute the following.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>./wsdl2java.sh -uri WSDL_PATH_OF_THE_SIMPLESERVICE -o client
</span></code></pre></td></tr></table></div></figure>


<p>The WSDL path would be something similar to <code>http://localhost:8080/axis2/services/SimpleService?wsdl</code>.</p>

<p>This will create the Java stub and the CallbackHandler classes. The CallbackHandler class can be extended to implement custom success and error callback executions. The Stub is the class of main importance here. It contains the Request and Response types of the operations available from the Service it was generated from and the skeletol methods that call to the target endpoint once invoked. We will use these members to call our simple service.</p>

<figure class='code'><figcaption><span>SimpleServiceClient.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">chamiladealwis</span><span class="o">.</span><span class="na">ws</span><span class="o">.</span><span class="na">client</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.rmi.RemoteException</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.apache.axis2.AxisFault</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.chamiladealwis.ws.client.SimpleServiceStub.Add</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.chamiladealwis.ws.client.SimpleServiceStub.AddResponse</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleClient</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="k">try</span>
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="c1">// Create the Stub object</span>
</span><span class='line'>            <span class="n">SimpleServiceStub</span> <span class="n">serviceStub</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleServiceStub</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Create the Request object. The request class is autogenerated</span>
</span><span class='line'>            <span class="c1">// as an inner class of the Stub class.</span>
</span><span class='line'>            <span class="n">Add</span> <span class="n">addReq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Add</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Set parameters</span>
</span><span class='line'>            <span class="n">addReq</span><span class="o">.</span><span class="na">setNum1</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>
</span><span class='line'>            <span class="n">addReq</span><span class="o">.</span><span class="na">setNum2</span><span class="o">(</span><span class="mi">8</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Invoke method and get response as a response object</span>
</span><span class='line'>            <span class="n">AddResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">serviceStub</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">addReq</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Response object&#39;s get_return() returns the return of the remote </span>
</span><span class='line'>            <span class="c1">// method</span>
</span><span class='line'>            <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">get_return</span><span class="o">();</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Sum : &quot;</span> <span class="o">+</span> <span class="n">sum</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">catch</span> <span class="o">(</span><span class="n">AxisFault</span> <span class="n">e</span><span class="o">)</span>
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">catch</span> <span class="o">(</span><span class="n">RemoteException</span> <span class="n">e</span><span class="o">)</span>
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s go through the client code.</p>

<p>Consuming an operation available through a Web Service consists of following steps.</p>

<ul>
<li>Create an object of the stub. All method calls will be invoked through this object.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">SimpleServiceStub</span> <span class="n">serviceStub</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleServiceStub</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Create the request object. This will have methods to add input parameters to the request.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Add</span> <span class="n">addReq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Add</span><span class="o">();</span>
</span><span class='line'><span class="n">addReq</span><span class="o">.</span><span class="na">setNum1</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>
</span><span class='line'><span class="n">addReq</span><span class="o">.</span><span class="na">setNum2</span><span class="o">(</span><span class="mi">8</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Invoke and the operation method. The operation method will be invoked through the stub object and the invocation accepts a parameter of type of request object.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">serviceStub</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">addReq</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Catch the response object. The invocation will return the response object mainly containing the value returned by the operation.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">AddResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">serviceStub</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">addReq</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Extract the return value. By calling <code>get_return()</code> of the response object the return value can be extracted.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">get_return</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you see it&rsquo;s pretty straightforward, although there are couple of things to keep in mind.</p>

<ol>
<li>You have to regenerate the client stubs everytime you change most of the server code (obviously).</li>
<li>It&rsquo;s good to check if the service has been properly deployed by going to the services page and checking the WSDL generation.</li>
<li>This was a <em>simple</em> client with <em>simple</em> input and output types. When complex types are involved there are some standards to be practiced. Be mindful that Web Services operate on a language and platform agnostic environment.</li>
<li><em>You will not be writing web services and clients this way most of the time!</em> But that&rsquo;s a topic for another post :)</li>
</ol>


      
      
    </div>
  </div>



    </article>
    
    <hr>
    
  
  
    <article>
      

  <div class="row-fluid">
    <div class="span2 post-meta">
	  <h5 class="date-time">








  


<i class="icon-calendar-empty"></i> <time datetime="2014-06-10T14:52:58+05:30" pubdate data-updated="true">Jun 10<sup>th</sup>, 2014</time></h5>
          <div class="row-fluid">
          
          </div>
          
          <div class="row-fluid">
          
          <a href="/blog/categories/misc/"><span class="badge">misc</span></a>
          
          </div>
          
    </div>
    <div class="span10 post-container">
      <h1 class="link"><a href="/blog/2014/06/10/what-to-expect/">what to expect</a></h1>
      <p>You&rsquo;ll find here, everyday bits and pieces of technical know-how, workarounds and fixes for common issues that I&rsquo;m assuming I&rsquo;d forget in a few hours.</p>

<p>Basically this would serve me as my technical blog.</p>

<p>A coder&rsquo;s journel.</p>

<p>Allons-y!</p>

      
      
    </div>
  </div>



    </article>
    
  
  <div class="pagination">
    

    
  </div>
</div>


        </div>
      </div>
      <div class="row-fluid">
        <footer class="footer-page" role="contentinfo">
          <p>
  Copyright &copy; 2014 - chamila de alwis -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> - Theme by <a href="http://alexgaribay.com">Alex Garibay</a>
</p>


        </footer>
      </div>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'chamila-01';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
