<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Hugo 0.92.2" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="" />
  <meta property="og:url" content="https://chamila.dev/blog/2023-02-17_malware-protection-on-aws/" />
  <link rel="canonical" href="https://chamila.dev/blog/2023-02-17_malware-protection-on-aws/" /><script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "BlogPosting",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https:\/\/chamila.dev\/"
      },
      "articleSection" : "blog",
      "name" : "Malware Protection on AWS",
      "headline" : "Malware Protection on AWS",
      "description" : "An overall introduction to malware protection strategies in AWS",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "2023",
      "datePublished": "2023-02-25 07:00:19 \u002b1300 NZDT",
      "dateModified" : "2023-02-25 07:00:19 \u002b1300 NZDT",
      "url" : "https:\/\/chamila.dev\/blog\/2023-02-17_malware-protection-on-aws\/",
      "keywords" : [ "AWS","Malware Protection","ISO27001","NZISM","GuardDuty","Amazon Inspector", ]
  }
</script>
<title>Malware Protection on AWS - chamila.dev</title>
  <meta property="og:title" content="Malware Protection on AWS - chamila.dev" />
  <meta property="og:type" content="article" />
  <meta name="description" content="An overall introduction to malware protection strategies in AWS" />

  <link rel="stylesheet" href="https://unpkg.com/flexboxgrid@6.3.1/dist/flexboxgrid.min.css" />
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/tomorrow.min.css" />
  <link rel="stylesheet" href="/css/index.css">
  <link rel="stylesheet" href="/css/light.css">
  <link rel="stylesheet" href="/css/dark.css">
  <link href="/blog/index.xml" rel="alternate" type="application/rss+xml" title="chamila.dev">

  <link href="/fa/css/all.css" rel="stylesheet">

  
  
  
  
  <script>
    

    (function (undefined) { }).call('object' === typeof window && window || 'object' === typeof self && self || 'object' === typeof global && global || {});
  </script>

  

</head>


<body class="theme-light">
  <article class="post " id="article">
    <div class="row">
      <div class="container col-xs-12 col-sm-10 col-md-8 col-sm-offset-1 col-md-offset-2 col-lg-6 col-lg-offset-3">
        <div id="floating-menu-wrapper">
  <div id="floating-menu">
    <button id="switch-to-dark" title="dark theme">
      <i class="fas fa-moon"></i>
    </button>
    <button id="switch-to-light" title="light theme" class="current-theme">
      <i class="fas fa-sun"></i>
    </button>
  </div>
</div>

        <div class="site-header">
          
<header>
  <div class="signatures site-title">
    <span class="breadcrumbs">
      <a href="https://chamila.dev/">chamila.dev</a> >
      <a href="https://chamila.dev//blog"> journal </a> >
    </span>
    <div class="sm-icons">
  <a href="https://chamila.dev//blog/index.xml" target="_blank" title="rss">
    <i class="fas fa-rss sm-icon"></i>
  </a>
  <a href="https://github.com/chamilad" target="_blank" title="github">
    <i class="fab fa-github sm-icon"></i>
  </a>
  <a href="https://fosstodon.org/@chamilad" target="_blank" title="fosstodon" rel="me">
    <i class="fab fa-mastodon sm-icon"></i>
  </a>
</div>

  </div>
</header>
<div class="row end-xs">
   
</div>


        </div>
        <header class="post-header">
          <h1 class="post-title">Malware Protection on AWS</h1>
          
          <div class="row post-desc">
            <div class="pub-date col-xs-6">
              
              <time class="post-date" datetime=" 2023-02-25 07:00:19 NZDT">
                25 Feb 2023
              </time>
              
            </div>
            <div class="reading-time col-xs-6" title="approximate read time">
              ~8 minutes
            </div>
            
            
            
          </div>
          
          <div class="toc">
            
            <h4>Table of Contents:</h4>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#typical-malware-protection-requirements">Typical Malware Protection Requirements</a>
      <ul>
        <li><a href="#automated">Automated</a></li>
        <li><a href="#threat-intelligence-sources">Threat Intelligence Sources</a></li>
        <li><a href="#cloud-native">Cloud-native</a></li>
      </ul>
    </li>
    <li><a href="#compliance-requirements">Compliance Requirements</a></li>
    <li><a href="#malware-protection-in-aws">Malware Protection in AWS</a>
      <ul>
        <li><a href="#targets">Targets</a></li>
        <li><a href="#approaches">Approaches</a></li>
        <li><a href="#strategies">Strategies</a></li>
      </ul>
    </li>
  </ul>
</nav>
            
          </div>
        </header>
        <div class="post-content markdown-body">
          <figure><img src="/blog/img/2023-02-25_aws-malware-protection-header.jpeg"/><figcaption>
            <h4>Point Dorset, Wellington</h4>
        </figcaption>
</figure>

<p>Malware protection in compute workloads in AWS is a topic that I&rsquo;ve been
looking into recently. After working with security auditors for a few weeks
(adding up a few months now), I was essentially forced to evaluate all the
possible scenarios for malware protection in AWS for typical workloads.</p>
<h2 id="typical-malware-protection-requirements">Typical Malware Protection Requirements</h2>
<p>The following key features can be identified as typical malware protection
requirements for most solutions.</p>
<h3 id="automated">Automated</h3>
<p>Regardless of the approach for malware detection and protection, the need for
the process to be automated is a key requirement. This removes the human
intervention from the execution part of the loop which reduces costs and
potential windows for errors. At the same time, automated malware scans can
improve reactive protection strategies to be somewhat proactive, based on the
parameters of the solution. A frequently run vulnerability scan could
potentially close off gaps that threat actors could exploit to install malware,
mitigating untreated risk levels for malware protection in a solution.</p>
<h3 id="threat-intelligence-sources">Threat Intelligence Sources</h3>
<p>Malware and vulnerability scanners work off of threat intelligence databases.
These are common vulnerability and malware signature databases that can be used
to keep the scanning jobs relevant and up to date. The malware protection
should be able to incorporate these sources in to the design with minimal
administration overhead.</p>
<h3 id="cloud-native">Cloud-native</h3>
<p>There is no rule that forces cloud based solutions to only use Cloud-Native
malware protection strategies. In fact, whichever design that works best with
existing infrastructure and support services (security event and incident
management, general incident response processes, service desks) could be the
best solution. However, for newly designed solutions, making use of
cloud-native solutions reduces both the operational overhead and potentially
the cost of licensing and management for third party solutions. Such a service
should integrate seemlessly with the compute services of the solution,
providing features like agentless scanning, resource detection, and cloud
provider managed threat intelligence.</p>
<h2 id="compliance-requirements">Compliance Requirements</h2>
<p>While implementing a solution wide malware protection design will not make you
ISO27001 compliant, it is still good to understand the general compliance
landscape around malware protection.</p>
<p>ISO27001 refers to malware protection with regards to organizational stance on
user awareness, detection, prevention, and recovery controls for malware. While
there are process and culture components that should be implemented, for
organizational information processing systems, implementing a malware
protection design is still part of the core controls that make up this
requirement.</p>
<p>Based on the ISO27001 requirements, NZISM refers to malware protection mainly
in <a href="https://nzism.gcsb.govt.nz/ism-document/#Section-15006">Standard Operating Environments (SOE)
section</a>. This is in relation to
developing and maintaining secure and trusted workstations.</p>
<p>However, each organization and solution could adapt its own set of security
requirements that are more specific to the context. This can include detecting
and guarding against vulnerabilities and malware in business logic execution. While
some typical AWS compute instances may be considered as SOEs in some contexts,
each use case might be different for compliance requirements for cloud based
solutions.</p>
<h2 id="malware-protection-in-aws">Malware Protection in AWS</h2>
<p>Having briefly discussed the typical compliance requirements for malware
protection, let&rsquo;s consider more AWS specific details of the topic.</p>
<h3 id="targets">Targets</h3>
<p>The following compute services are the most common targets to be considered for
malware protection designs.</p>
<ol>
<li>EC2 - AMIs and running instance storage should be subject to proactive scans
for vulnerabilities and malware. New instances should be part of these scans
automatically to achieve the best possible posture against malware.</li>
<li>ECS - While ECS runtime might be out of the user&rsquo;s part of the shared
responsibility model in AWS for Fargate based compute workloads, the
Container images that compose the runtime for each Task should still be
subjected to malware protection scans. EC2 based runtime instances are
covered in the EC2 scans.</li>
<li>Lambda Functions - Lambda functions being the most managed solution out of
these compute services, can be vulnerable to malware through supply chain
attacks. Dependencies that are packed into a function layer should be
scanned frequently (ideally, on each test build) for malicious or
compromised libraries and artefacts</li>
<li>EKS - While both ECS and EKS make use of Containers as the baseline compute process
in the user&rsquo;s part of the share responsibility model in AWS, K8s itself brings
its own security requirements and checks. These are formulated in a well
structured manner in CIS Benchmarks for EKS, a more specific version of
generic K8s CIS Benchmarks.</li>
</ol>
<h3 id="approaches">Approaches</h3>
<h4 id="third-party-host-based-malware-scanners">Third Party Host-based Malware Scanners</h4>
<p>Each user managed compute instance could be installed malware scanners like
anti-virus tools that may continuously or on-demand, scan the runtime and the
file system for known malware signatures. While this can be really specific to
each type of runtime used on the solution (ex: different scanners for Linux and
Windows hosts), the management overhead for a design like this can be quite
high. Each machine image will have to be managed separately and the images
themselves need to be constantly kept up to date to make sure threat
intelligence sources are updated. Furthermore, host based malware scanners
could be compromised by malicious actors if the underlying host is compromised,
since most of these scanners do not check for vulnerabilities from an external
point of view (ex: network configuration gaps). For ephemeral workloads that do
not store data that cannot be reproduced, host based malware scanners may be
overkill while still not providing the vulnerability assessments to keep the
deployment safe.</p>
<p>Most importantly, these scanners may be able to cover only EC2 instances for
their malware scans. This makes this approach less desirable, especially when
the operational overhead is considered.</p>
<h4 id="ecr-basic-scanning">ECR Basic Scanning</h4>
<p><a href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-scanning-basic.html">ECR Basic
Scanning</a>
is a feature enabled at the Container Registry level to
detect vulnerabilities in the Container Images pushed to an ECR Container
Registry. The Threat Intelligence for Basic Scanning is based on the <a href="https://github.com/quay/clair">Clair
project</a> by Redhat Quay. Clair supports the
Docker image format that ECR uses and is frequently updated.</p>
<p>It is recommended to enable ECR Basic Scanning to perform scans on image push,
rather than manually triggering scan. This goes back to the point of automated
scanning discussed at the top, where simple vulnerability scanning could
mitigate a broad range of malware based risks in the solution. Any potential
malware should be detected before the Container image is used to spawn a
runtime. Furthermore, Basic Scanning sends events to Amazon EventBridge when a
scan job is done. This enables an automated response loop, where (for
example), scan results that show any number of <code>CRITICAL</code> findings result in
the pushed image being blacklisted, untagged, or deleted off the repository.</p>
<p>ECR Basic Scanning is a free service, which is better replaced by Enhanced
Scanning.</p>
<h4 id="amazon-inspector">Amazon Inspector</h4>
<p><a href="https://docs.aws.amazon.com/inspector/latest/user/scanning-resources.html">Amazon
Inspector</a>
is a cloud-native proactive vulnerability scanning service
that covers the most number of targets discussed before. It scans EC2 instances
for software and network level vulnerabilities, without having to use an
additional agent than the AWS SSM Agent that most solutions will already
include.</p>
<p>For Container Images, Amazon Inspector is able to perform Enhanced
Scanning for images pushed to ECR registries. Unlike Basic Scanning, Enhanced
Scanning is able to perform continuous scanning, which can be helpful to reduce
the time to find and mitigate newly discovered vulnerabilities.</p>
<p>Lambda functions code and layers can be part of Amazon Inspector vulnerability
scans as well. While the support for runtimes is somewhat limited, the function
code and dependencies are scanned as the function is updated with the latest
code.</p>
<p>All the findings can be centralised into AWS Security Hub which provides a
single pane of glass view into the security posture of an AWS Organization.</p>
<p>Amazon Inspector is priced mainly on the volume of data scanned, i.e. the usage
based pricing model AWS services generally provide.</p>
<h4 id="guardduty-malware-protection">GuardDuty Malware Protection</h4>
<p><a href="https://docs.aws.amazon.com/guardduty/latest/ug/malware-protection.html">GuardDuty Malware
Protection</a>
is a feature introduced relatively recently. Just
as GuardDuty in overall, GuardDuty Malware Protection is a reactive service. It
scans for malicious activity in EC2 EBS based workloads. Unlike Amazon
Inspector, this does not scan Container images or AMIs. Therefore, the
malicious activity has to be executed for GuardDuty Malware Protection to flag
it as a finding.</p>
<p>The scans are agentless, meaning not even SSM agent needs to live in the
instance that is subject to scan. The scanning jobs themselves are triggered
when GuardDuty detects a selected list of findings on EC2 instances or
Container workloads running on EC2 instances. Snapshots of the EBS disks
attached to the EC2 instances that cause these findings are then taken to be
scanned seperately from live instances. This makes sure that scanning jobs are
not impacting system performance. Those snapshots in which malware is detected
are retained for further manual/external system based inspection.</p>
<h3 id="strategies">Strategies</h3>
<p>As it is evident from the above approaches, no single option is a &ldquo;the&rdquo;
solution for malware protection. Depending on the solution a combination of
approaches will be needed to cover Containers, EC2 instances, Serverless
functions, and their runtime images.</p>
<p>For example, a solution that has
moderate malware protection requirements (based on impact, likelihood of being
targeted, the severity of data being compromised, and residual risk after other
mitigations are applied), only using using Amazon Inspector for proactive
vulnerability scans may be enough for most solutions.</p>
<p>In others, a
comprehensive solution with supply chain protection enforced at the CI
pipelines, benchmarks, GuardDuty, Amazon Inspector, and GuardDuty Malware
Protection may be required.</p>

        </div>
        <div class="prev-next row">
	<div class="prev col-sm">
	
	<a href="https://chamila.dev/blog/2023-02-20_aws-backup-implementing-a-simple-cross-account-backup-strategy/">&lt; AWS Backup: Implementing a Simple Cross-Account Backup Strategy</a>
		
	</div>        
	<div class="next col-sm">
		
	</div>
</div>


        

        

<div class="releated-content">
  <h3>Related Posts</h3>
  <ul>
    
    <li><a href="/blog/2023-02-13_aws-backup-cross-account-backups/">AWS Backup: Cross-Account Backups</a></li>
    
    <li><a href="/blog/2023-01-18_aws-backup-intro/">AWS Backup: Introduction</a></li>
    
    <li><a href="/blog/2022-11-25_mlops-for-non-ml-engineers-03/">MLOps for Non-ML Engineers 03 - More Differences Between ML and SW Dev</a></li>
    
  </ul>
</div>


        
        
        
        
        

        <div class="site-footer">
  

  <div class="sm-icons">
  <a href="https://chamila.dev//blog/index.xml" target="_blank" title="rss">
    <i class="fas fa-rss sm-icon"></i>
  </a>
  <a href="https://github.com/chamilad" target="_blank" title="github">
    <i class="fab fa-github sm-icon"></i>
  </a>
  <a href="https://fosstodon.org/@chamilad" target="_blank" title="fosstodon" rel="me">
    <i class="fab fa-mastodon sm-icon"></i>
  </a>
</div>

  
  All photos published on this site are copyrighted.
  <div class="site-footer-item">
    Modified
    <a href="https://github.com/joway/hugo-theme-yinyang" target="_blank">YinYang</a>
    theme
  </div>
</div>

      </div>
    </div>
  </article>

  <script src="/js/highlight.pack.js"></script>
<script src="/js/theme.js"></script>


<script>
  hljs.initHighlightingOnLoad();

  var posts = document.getElementById('posts-list');
  posts && quicklink({
    el: posts,
    priority: true,
  });
</script>

  

</body>

</html>
