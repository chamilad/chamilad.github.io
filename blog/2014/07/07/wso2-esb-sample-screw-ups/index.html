
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>WSO2 ESB Sample Screw Ups - nuts!</title>
  <meta name="author" content="chamila">

  
  <meta name="description" content="We all know the feeling when we follow every instruction of a sample page to the letter and the results turn out to be a total clusterf.. disaster. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://chamilad.github.io/blog/2014/07/07/wso2-esb-sample-screw-ups">
  <link href="/favicon.ico" rel="icon">
  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="nuts!" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Roboto+Slab:300' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Merriweather' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
  

</head>

<body   class="no-sidebar"  >
  <header role="banner"><hgroup>
  <a href="/"><h2>nuts!</h2></a>
  
    <h1>Ramblings on Cloud Computing, Middleware and Beer</h1>
  
</hgroup>

</header>
  <nav role="navigation">
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:chamilad.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">WSO2 ESB Sample Screw Ups</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-07T12:26:35+05:30" pubdate data-updated="true">Jul 7<sup>th</sup>, 2014</time> 
  

<span class="byline author vcard">Posted by <span class="fn"><a href="/about" title="About the author (chamila)" rel="author">chamila</a></span></span>
 

<span class="categories">
  
    <a class='category label label-primary' href='/blog/categories/esb/'>esb</a> <a class='category label label-primary' href='/blog/categories/wso2/'>wso2</a>
  
</span>


        
      </p>
    
  </header>


<div class="entry-content"><p>We all know the feeling when we follow every instruction of a sample page to the letter and the results turn out to be a total <del>clusterf..</del> disaster.</p>

<p>Well, let me try to easy some of the pain by listing the following probable fixes and workarounds for the 100-odd samples of the renowned <a href="http://wso2.com/products/enterprise-service-bus/">WSO2 Enterprise Service Bus</a>.</p>

<blockquote><p>Keep in mind that this post will keep getting updated till I go through every sample.</p></blockquote>

<h1>Sample 50</h1>

<p>The synapse configuration file that is shipped with 4.8.1 has an error where asterisks are missing from a filter mediater regex. Therefore execution of the main sequence stops after failing to match any <code>To</code> SOAP headers.</p>

<h2>Fix</h2>

<p>Change the following line in <code>&lt;ESB_HOME&gt;/repository/samples/synapse_sample_50.xml</code> to include the asterisks.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;filter</span> <span class="na">source=</span><span class="s">&quot;get-property(&#39;To&#39;)&quot;</span> <span class="na">regex=</span><span class="s">&quot;./StockQuote.&quot;</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The modified line should be as follows.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;filter</span> <span class="na">source=</span><span class="s">&quot;get-property(&#39;To&#39;)&quot;</span> <span class="na">regex=</span><span class="s">&quot;.*/StockQuote.*&quot;</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Sample 57</h1>

<p>In ESB 4.8.1 running this sample would not result in the expected outcome and would throw an error similar to the following.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>org.apache.synapse.SynapseException: A LoadBalanceEventHandler has not been
</span><span class='line'>specified in the axis2.xml file for the domain apache.axis2.application.domain
</span><span class='line'>at
</span><span class='line'>org.apache.synapse.core.axis2.Axis2LoadBalanceMembershipHandler.setConfigurationContext(Axis2LoadBalanceMembershipHandler.java:77)
</span></code></pre></td></tr></table></div></figure>


<p>The reason for this is the incompatibility between the clustering mechanisms used in ESB 4.8.1 (HazelCast) and the sample Axis2 server (Apache Tribes) it ships with.</p>

<h2>Fix</h2>

<p>As <a href="http://wso2-oxygen-tank.10903.n7.nabble.com/Dev-Running-ESB-sample-57-td89484.html">this</a> email thread mentions this can be overcome by getting ESB 4.7.0 where the same clustering implementation is used that of the Axis2 server.</p>

<h1>Sample 60, 61, 62</h1>

<p>In ESB 4.8.1 the synapse configuration files for the samples 60, 61, and 62 are missing and the configurations that are on the sample pages are errorneous.
For an example in sample #61 the mentioned configuration refers to a property named <code>EP_LIST</code> while there&rsquo;s no external registry resource or inline defined property that is of the name EP_LIST.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;send&gt;</span>
</span><span class='line'>    <span class="nt">&lt;endpoint&gt;</span>
</span><span class='line'>        <span class="nt">&lt;recipientlist&gt;</span>
</span><span class='line'>            <span class="nt">&lt;endpoints</span> <span class="na">value=</span><span class="s">&quot;{get-property(&#39;EP_LIST&#39;)}&quot;</span> <span class="na">max-cache=</span><span class="s">&quot;20&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/recipientlist&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/endpoint&gt;</span>
</span><span class='line'><span class="nt">&lt;/send&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Fix</h2>

<p>However these synapse configuration files are present in the 4.7.0 release and they can be used to start the 4.8.1 ESB with the desired configuration.</p>

<h1>Sample 152</h1>

<p>You would probably get an error while trying to execute the client like the following.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>[2014-07-07 13:28:09,060] ERROR - ServerWorker Error processing POST request
</span><span class='line'>java.lang.NullPointerException: Tenant domain has not been set in CarbonContext
</span><span class='line'>    at org.wso2.carbon.caching.impl.CacheManagerFactoryImpl.getCacheManager(CacheManagerFactoryImpl.java:79)
</span><span class='line'>    at org.wso2.carbon.security.pox.POXSecurityHandler.getPOXCache(POXSecurityHandler.java:383)
</span><span class='line'>    at org.wso2.carbon.security.pox.POXSecurityHandler.invoke(POXSecurityHandler.java:179)
</span><span class='line'>    at org.apache.axis2.engine.Phase.invokeHandler(Phase.java:340)
</span><span class='line'>    at org.apache.axis2.engine.Phase.invoke(Phase.java:313)
</span><span class='line'>    at org.apache.axis2.engine.AxisEngine.invoke(AxisEngine.java:261)
</span><span class='line'>    at org.apache.axis2.engine.AxisEngine.receive(AxisEngine.java:167)
</span><span class='line'>    at org.apache.axis2.transport.http.HTTPTransportUtils.processHTTPPostRequest(HTTPTransportUtils.java:172)
</span><span class='line'>    at org.apache.synapse.transport.nhttp.ServerWorker.processEntityEnclosingMethod(ServerWorker.java:459)
</span><span class='line'>    at org.apache.synapse.transport.nhttp.ServerWorker.run(ServerWorker.java:279)
</span><span class='line'>    at org.apache.axis2.transport.base.threads.NativeWorkerPool$1.run(NativeWorkerPool.java:172)
</span><span class='line'>    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
</span><span class='line'>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
</span><span class='line'>    at java.lang.Thread.run(Thread.java:722)
</span></code></pre></td></tr></table></div></figure>


<p>While I can&rsquo;t exactly pinpoint the cause of the error this happens due to the way we execute the samples. If you directly executed the sample #152 chances are that you wouldn&rsquo;t come across this. But if you started with a sample before #101 you&rsquo;d probably get this.</p>

<p>At sample #101 you have to enable the NHTTP configuration for Carbon. Non-Blocking HTTP is required to enable WS-ReliableMessaging so that the source can call the Web Service destination asynchronously.</p>

<p>You are instructed to enable NHTTP configuration by editing the <code>carbon.xml</code> file in <code>&lt;ESB_HOME&gt;/repository/conf/</code>.</p>

<figure class='code'><figcaption><span>carbon.xml start:253</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="c">&lt;!-- You are instructed to comment this line and enable the next one to enable NHTTP --&gt;</span>
</span><span class='line'><span class="nt">&lt;ConfigurationFile&gt;</span>${carbon.home}/repository/conf/axis2/axis2.xml<span class="nt">&lt;/ConfigurationFile&gt;</span>
</span><span class='line'><span class="nt">&lt;ConfigurationFile&gt;</span>${carbon.home}/repository/conf/axis2/axis2_nhttp.xml<span class="nt">&lt;/ConfigurationFile&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Fix</h2>

<p>To make the sample #152 run properly revert this change.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn"><a href="/about" title="About the author (chamila)" rel="author">chamila</a></span></span>

      








  


<time datetime="2014-07-07T12:26:35+05:30" pubdate data-updated="true">Jul 7<sup>th</sup>, 2014</time>
      

<span class="categories">
  
    <a class='category label label-primary' href='/blog/categories/esb/'>esb</a> <a class='category label label-primary' href='/blog/categories/wso2/'>wso2</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://chamilad.github.io/blog/2014/07/07/wso2-esb-sample-screw-ups/" data-via="chamilad" data-counturl="http://chamilad.github.io/blog/2014/07/07/wso2-esb-sample-screw-ups/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="small"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/07/01/creating-a-web-service-using-apache-axis2-no-ide/" title="Previous Post: Creating a Web Service using Apache Axis2 [No IDE]">&laquo; Creating a Web Service using Apache Axis2 [No IDE]</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/07/09/wireshark-crashing-in-ubuntu/" title="next Post: Wireshark Crashing in Ubuntu">Wireshark Crashing in Ubuntu &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - chamila -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'chamila-01';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://chamilad.github.io/blog/2014/07/07/wso2-esb-sample-screw-ups/';
        var disqus_url = 'http://chamilad.github.io/blog/2014/07/07/wso2-esb-sample-screw-ups/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
